%\VignetteEngine{utils::Sweave}
%\VignetteIndexEntry{LRBaseDbi}

\documentclass[11pt,a4paper,english,arial,twoside]{article}

\RequirePackage[]{/Library/Frameworks/R.framework/Versions/3.5/Resources/library/BiocStyle/resources/tex/Bioconductor}
\AtBeginDocument{\bibliographystyle{/Library/Frameworks/R.framework/Versions/3.5/Resources/library/BiocStyle/resources/tex/unsrturl}}
\usepackage[noae, nogin]{Sweave}
\usepackage[numbers]{natbib}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{hyperref,url}
\usepackage[utf8]{inputenc}
\usepackage{comment}

\setlength{\textheight}{8.5in}
\setlength{\textwidth}{6in}
\setlength{\topmargin}{-0.25in}
\setlength{\oddsidemargin}{0.25in}
\setlength{\evensidemargin}{0.25in}

\usepackage{Sweave}
\begin{document}
\input{LRBaseDbi-concordance}

\title{\bf Introduction to LRBaseDbi and LRBase.XXX.eg.db-type packages}
\author{Koki Tsuyuzaki$^1$, Manabu Ishii$^1$, and Itoshi Nikaido$^1$.}
\maketitle
\begin{center}
\noindent
$^1$Laboratory for Bioinformatics Research, RIKEN Center for Biosystems
Dynamics Research, Japan\\
\noindent
\end{center}

\begin{center}
{\tt k.t.the-answer@hotmail.co.jp}
\end{center}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Introduction}

This document provides the way to use LRBaseDbi and LRBase.XXX.eg.db-type packages.
LRBase.XXX.eg.db-type packages provide the pair list of ligand - receptor genes.
The packages are generated by the LRBaseDbi package.
LRBaseDbi has two role; class-definition and the construction of LRBase.XXX.eg.db-type packages.
LRBaseDbi defines the class "LRBaseDb" and unify the objects's behavior such as column function described later.
The makeLRBasePackage function of LRBaseDbi generates the user's original LRBase.XXX.eg.db-type packages.

\section{makeLRBasePackage}

Here we use makeLRBasePackage function to create a LRBase.XXX.eg.db-type package.
Only user have to specify are 1. a LR-list containing the columns "GENEID$\_$L" (ligand NCBI Gene IDs) and "GENEID$\_$R" (receptor NCBI Gene IDs) and 2. a meta information table describing the LR-list. 
Here we use the demo data of LR-list of FANTOM5 project.

\begin{center}
\begin{Schunk}
\begin{Sinput}
> library('LRBaseDbi')
\end{Sinput}
\begin{Soutput}
[1] "LRBaseDbi" "stats"     "graphics"  "grDevices" "utils"     "datasets" 
[7] "methods"   "base"     
\end{Soutput}
\begin{Sinput}
> example('makeLRBasePackage')
\end{Sinput}
\begin{Soutput}
mkLRBP> ## makeLRBasePackage enable users to construct
mkLRBP> ## user's own custom LRBase package
mkLRBP> data(FANTOM5)

mkLRBP> head(FANTOM5)
  GENEID_L GENEID_R SOURCEID SOURCEDB
1      805       19        -  FANTOM5
2      808       19        -  FANTOM5
3      801       19        -  FANTOM5
4     5360       19        -  FANTOM5
5     9699       19        -  FANTOM5
6    50944       19        -  FANTOM5

mkLRBP> # We are also needed to prepare meta data as follows.
mkLRBP> data(metaFANTOM5)

mkLRBP> metaFANTOM5
              NAME
1       SOURCEDATE
2       SOURCENAME
3        SOURCEURL
4         DBSCHEMA
5  DBSCHEMAVERSION
6         ORGANISM
7          SPECIES
8          package
9          Db type
10         VERSION
                                                                           VALUE
1                                                                   22-July-2015
2                                                                        FANTOM5
3  http://fantom.gsc.riken.jp/5/suppl/Ramilowski_et_al_2015/data/PairsLigRec.txt
4                                                              FANTOM5.Hsa.eg.db
5                                                                            1.0
6                                                                   Homo sapiens
7                                                                          Human
8                                                                  AnnotationDbi
9                                                                       LRBaseDb
10                                                                          2018

mkLRBP> ## sets up a temporary directory for this example
mkLRBP> ## (users won't need to do this step)
mkLRBP> destination <- tempfile()

mkLRBP> dir.create(destination)

mkLRBP> ## makes an Organism package for human called Homo.sapiens
mkLRBP> makeLRBasePackage(pkgname = "FANTOM5.Hsa.eg.db",
mkLRBP+     data = FANTOM5,
mkLRBP+     metadata = metaFANTOM5,
mkLRBP+     organism = "Homo sapiens",
mkLRBP+     version = "0.99.0",
mkLRBP+     maintainer = "Koki Tsuyuzaki <k.t.the-answer@hotmail.co.jp>",
mkLRBP+     author = "Koki Tsuyuzaki",
mkLRBP+     destDir = destination,
mkLRBP+     license="Artistic-2.0")
Creating package in /var/folders/k0/tk8gl4bj2_v2mbjx80ydsznw0000gn/T//RtmpkPGJzQ/file185093a91714c/FANTOM5.Hsa.eg.db 
$value
[1] TRUE

$visible
[1] FALSE
\end{Soutput}
\end{Schunk}
\end{center}

After makeLRBasePackage, FANTOM5.Hsa.eg.db is generated.
Here, we will install the package.

\begin{center}
\begin{Schunk}
\begin{Sinput}
> filepath <- list.files(destination, full.names=TRUE)
> install.packages(filepath, repos=NULL, type='source')
> library('FANTOM5.Hsa.eg.db')
\end{Sinput}
\end{Schunk}
\end{center}

\section{columns, keytypes, keys, and select}

All LRBase.XXX.eg.db-type package has same name object and it is instantiated by LRBaseDb-class.
Many data access function for this object are implmented. For example, columns returns the rows which we can retrieve in LRBase.XXX.eg.db-type packages. keytypes returns the rows which can be used as the optional parameter in keys and select functions against LRBase.XXX.eg.db-type packages. keys function returns the value of keytype. select function returns the rows in particular columns, which are having user-specified keys. This function returns the result as a dataframe.

\begin{center}
\begin{Schunk}
\begin{Sinput}
> columns(FANTOM5.Hsa.eg.db)
\end{Sinput}
\begin{Soutput}
[1] "GENEID_L" "GENEID_R" "SOURCEDB" "SOURCEID"
\end{Soutput}
\begin{Sinput}
> keytypes(FANTOM5.Hsa.eg.db)
\end{Sinput}
\begin{Soutput}
[1] "GENEID_L" "GENEID_R" "SOURCEDB" "SOURCEID"
\end{Soutput}
\begin{Sinput}
> key_FN5 <- keys(FANTOM5.Hsa.eg.db, keytype='GENEID_R')
> head(select(FANTOM5.Hsa.eg.db, keys=key_FN5[1:2],
+      columns=c('GENEID_L', 'GENEID_R'), keytype='GENEID_R'))
\end{Sinput}
\begin{Soutput}
  GENEID_L GENEID_R
1      805       19
2      808       19
3      801       19
4     5360       19
5     9699       19
6    50944       19
\end{Soutput}
\end{Schunk}
\end{center}

\section{Other functions}

Other additional functions like species, nomenclature, and listDatabases are available. In each LRBase.XXX.eg.db-type package, species function returns the common name and nomenclature returns the scientific name. listDatabases function returns the source of data. dbInfo returns the information of the package. dbfile returns the directory where sqlite file is stored. dbschema returns the schema of database. dbconn returns the connection to the sqlite database.

\begin{center}
\begin{Schunk}
\begin{Sinput}
> species(FANTOM5.Hsa.eg.db)
\end{Sinput}
\begin{Soutput}
[1] "Human"
\end{Soutput}
\begin{Sinput}
> nomenclature(FANTOM5.Hsa.eg.db)
\end{Sinput}
\begin{Soutput}
[1] "Homo sapiens"
\end{Soutput}
\begin{Sinput}
> listDatabases(FANTOM5.Hsa.eg.db)
\end{Sinput}
\begin{Soutput}
  SOURCEDB
1  FANTOM5
\end{Soutput}
\begin{Sinput}
> dbInfo(FANTOM5.Hsa.eg.db)
\end{Sinput}
\begin{Soutput}
              NAME
1       SOURCEDATE
2       SOURCENAME
3        SOURCEURL
4         DBSCHEMA
5  DBSCHEMAVERSION
6         ORGANISM
7          SPECIES
8          package
9          Db type
10         VERSION
                                                                           VALUE
1                                                                   22-July-2015
2                                                                        FANTOM5
3  http://fantom.gsc.riken.jp/5/suppl/Ramilowski_et_al_2015/data/PairsLigRec.txt
4                                                              FANTOM5.Hsa.eg.db
5                                                                            1.0
6                                                                   Homo sapiens
7                                                                          Human
8                                                                  AnnotationDbi
9                                                                       LRBaseDb
10                                                                          2018
\end{Soutput}
\begin{Sinput}
> dbfile(FANTOM5.Hsa.eg.db)
\end{Sinput}
\begin{Soutput}
[1] "/Library/Frameworks/R.framework/Versions/3.5/Resources/library/FANTOM5.Hsa.eg.db/extdata/FANTOM5.Hsa.eg.db.sqlite"
\end{Soutput}
\begin{Sinput}
> dbschema(FANTOM5.Hsa.eg.db)
\end{Sinput}
\begin{Soutput}
[1] "CREATE TABLE `METADATA` (\n  `NAME` TEXT,\n  `VALUE` TEXT\n)"                                                 
[2] "CREATE TABLE `DATA` (\n  `GENEID_L` INTEGER,\n  `GENEID_R` INTEGER,\n  `SOURCEID` TEXT,\n  `SOURCEDB` TEXT\n)"
\end{Soutput}
\begin{Sinput}
> dbconn(FANTOM5.Hsa.eg.db)
\end{Sinput}
\begin{Soutput}
<SQLiteConnection>
  Path: /Library/Frameworks/R.framework/Versions/3.5/Resources/library/FANTOM5.Hsa.eg.db/extdata/FANTOM5.Hsa.eg.db.sqlite
  Extensions: TRUE
\end{Soutput}
\end{Schunk}
\end{center}

%\clearpage
\section{Redirecting to the scTensor package}

Description for any LRBase-related packages is written in the vignette of
\Rpackage{scTensor} package.

\noindent
Please follow the link below
\newline\newline
\url{http://www.bioconductor.org/packages/release/bioc/html/scTensor.html}
\newline\newline
\noindent
or just type
\newline\newline
\noindent
> source('http://bioconductor.org/biocLite.R')

\noindent
> biocLite('scTensor')

\noindent
> library('scTensor')

\noindent
> vignette('scTensor')
\newline\newline
\noindent
in R console window.

\end{document}
